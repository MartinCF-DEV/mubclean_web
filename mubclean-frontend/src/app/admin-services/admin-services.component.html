<div class="page-container">
    <header class="page-header">
        <h1>Catálogo de Servicios</h1>
        <button class="add-btn" (click)="openDialog()">
            <span class="material-icons">add_photo_alternate</span>
            Nuevo Servicio
        </button>
    </header>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-container">
        <div class="spinner"></div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoading && services.length === 0" class="empty-state">
        <span class="material-icons empty-icon">category</span>
        <h3>Tu catálogo está vacío</h3>
        <p>Agrega servicios para que tus clientes puedan cotizar.</p>
    </div>

    <!-- List -->
    <div *ngIf="!isLoading && services.length > 0" class="services-grid">
        <div *ngFor="let s of services" class="service-card" [class.inactive]="!s.activo">
            <!-- Image Area -->
            <div class="card-image" [style.backgroundImage]="s.imagen_url ? 'url(' + s.imagen_url + ')' : ''"
                (click)="openDialog(s)">
                <div *ngIf="!s.imagen_url" class="no-image-placeholder">
                    <span class="material-icons">image_not_supported</span>
                </div>
                <div class="edit-badge">
                    <span class="material-icons">edit</span>
                </div>
            </div>

            <div class="card-content">
                <div class="card-header">
                    <h3 class="service-title" (click)="openDialog(s)">{{ s.nombre }}</h3>
                    <!-- Switch -->
                    <label class="switch" title="Activar/Desactivar">
                        <input type="checkbox" [checked]="s.activo" (change)="toggleActive(s)">
                        <span class="slider round"></span>
                    </label>
                </div>

                <p class="service-desc">{{ s.descripcion || 'Sin descripción' }}</p>
                <div class="meta-info">
                    <span class="badge type" *ngIf="s.tipo_servicio">{{ s.tipo_servicio }}</span>
                    <span class="status-text">{{ s.activo ? 'Activo' : 'Inactivo' }}</span>
                </div>
            </div>
        </div>
    </div>

    <!-- ADD/EDIT DIALOG -->
    <div class="modal-overlay" *ngIf="showDialog">
        <div class="modal">
            <div class="modal-header">
                <h2>{{ editingService ? 'Editar Servicio' : 'Nuevo Servicio' }}</h2>
                <button class="close-icon" (click)="closeDialog()"><span class="material-icons">close</span></button>
            </div>

            <div class="modal-body">
                <!-- Image Picker -->
                <div class="image-picker" (click)="fileInput.click()"
                    [style.backgroundImage]="imagePreview ? 'url(' + imagePreview + ')' : ''">
                    <input type="file" #fileInput style="display: none" (change)="onFileSelected($event)"
                        accept="image/*">
                    <div *ngIf="!imagePreview" class="upload-placeholder">
                        <span class="material-icons">add_a_photo</span>
                        <span>Subir Foto</span>
                    </div>
                    <div *ngIf="imagePreview" class="change-overlay">
                        <span class="material-icons">edit</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>Nombre del Servicio *</label>
                    <input type="text" [(ngModel)]="formNombre" placeholder="Ej: Lavado de Sala L" maxlength="50">
                </div>

                <div class="form-group">
                    <label>Descripción</label>
                    <textarea [(ngModel)]="formDesc" rows="2" placeholder="Detalles, beneficios..."
                        maxlength="200"></textarea>
                </div>

                <div class="form-group">
                    <label>Tipo de Servicio (Opcional)</label>
                    <input type="text" [(ngModel)]="formTipo" placeholder="Ej: Limpieza profunda" maxlength="30">
                </div>

                <div class="form-group">
                    <label>Notas Adicionales (Opcional)</label>
                    <textarea [(ngModel)]="formNotas" rows="2" placeholder="Información extra para el cliente..."
                        maxlength="150"></textarea>
                </div>

            </div>

            <div class="modal-footer">
                <button *ngIf="editingService" class="delete-btn" (click)="deleteService()" [disabled]="isProcessing">
                    Eliminar
                </button>
                <div class="spacer"></div>
                <button class="cancel-btn" (click)="closeDialog()" [disabled]="isProcessing">Cancelar</button>
                <button class="save-btn" (click)="saveService()" [disabled]="isProcessing || !formNombre">
                    <span *ngIf="isProcessing">Guardando...</span>
                    <span *ngIf="!isProcessing">Guardar</span>
                </button>
            </div>
        </div>
    </div>

</div>